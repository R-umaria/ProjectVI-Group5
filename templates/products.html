{% extends "base.html" %}
{% block title %}Shop - BoxedWithLove{% endblock %}

{% block content %}
<section class="page">
  <div class="page-row">
    <h1 class="h1">Shop All</h1>
    <a class="btn btn-secondary" href="{{ url_for('web_products') }}">Clear</a>
  </div>

  <form class="filters" method="get" action="{{ url_for('web_products') }}">
    <div class="filters-left">
      <label class="field">
        <span class="field-label">Search</span>
        <input class="input" name="search" type="search" placeholder="Search gift baskets..." value="{{ search }}" />
      </label>
    </div>

    <div class="filters-right">
      <label class="field">
        <span class="field-label">Category</span>
        <select class="select" name="category">
          <option value="">All</option>
          {% for c in categories %}
            <option value="{{ c.category_name }}" {% if category and category.lower() == c.category_name.lower() %}selected{% endif %}>{{ c.category_name }}</option>
          {% endfor %}
        </select>
      </label>

      <label class="field">
        <span class="field-label">Sort</span>
        <select class="select" name="sort">
          <option value="popular" {% if sort == 'popular' %}selected{% endif %}>Most Popular</option>
          <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Newest</option>
          <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
          <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
        </select>
      </label>

      <button class="btn btn-primary btn-lg" type="submit">Apply</button>
    </div>
  </form>

  <p id="add-msg" class="muted" aria-live="polite"></p>

  <div class="grid products-grid">
    {% for p in products %}
      <article class="card product-card">
        <a class="product-img" href="{{ url_for('web_product_detail', product_id=p.id) }}">
          {% if p.image_url %}
            <img src="{{ p.image_url }}" alt="{{ p.name }}" loading="lazy" />
          {% else %}
            <div class="product-placeholder" aria-hidden="true">üéÅ</div>
          {% endif %}
        </a>

        <div class="product-body">
          <div class="product-meta">
            {% if p.category %}
              <span class="chip">{{ p.category.category_name }}</span>
            {% endif %}
            {% if not p.is_available or p.stock <= 0 %}
              <span class="chip chip-danger">Out of stock</span>
            {% endif %}
          </div>

          <a class="product-title" href="{{ url_for('web_product_detail', product_id=p.id) }}">{{ p.name }}</a>
          <div class="product-price">${{ "%.2f"|format(p.price_cents/100) }}</div>
          <p class="muted small clamp-3">{{ p.description }}</p>

          <div class="product-actions">
            <a class="btn btn-outline" href="{{ url_for('web_product_detail', product_id=p.id) }}"style="width: 60px;">View</a>
            <input type="number" min="1" max="{{ p.stock }}" value="1" class="input quantity-input" id="qty-{{ p.id }}" style="width: 80px;"
              {% if (not p.is_available) or (p.stock <= 0) %}disabled{% endif %}
            />
            <button class="btn btn-primary" type="button" onclick="addToCart({{ p.id }}, document.getElementById('qty-{{ p.id }}').value)" {% if (not p.is_available) or (p.stock <= 0) %}disabled{% endif %}>
              Add to cart
            </button>
          </div>
        </div>
      </article>
    {% endfor %}
  </div>
</section>
{% endblock %}
